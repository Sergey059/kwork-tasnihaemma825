(() => {
  "use strict";

  document.addEventListener("DOMContentLoaded", function () {
    const burger = document.querySelector(".burger");
    const nav = document.querySelector(".nav");
    const body = document.querySelector("body");
    const valueInput = document.querySelector("#value");
    const resultInput = document.querySelector("#result");
    const dropdownButton = document.getElementById("dropdown-btn");
    const dropdownList = document.querySelector(".dropdown-list");
    const tokenIcon = document.querySelector(".token__icon");
    const tokenName = document.getElementById("token");
    const popup = document.querySelector(".popup");

    burger.addEventListener("click", toggleMenu);

    window.addEventListener("resize", closeMenuOnResize);

    if (popup) {
      document.addEventListener("click", togglePopup, true);
    }

    const Calculate = () => {
      valueInput.value = "";
      resultInput.value = "";

      if (valueInput && resultInput) {
        valueInput.addEventListener("input", calculateFormula);
      }
    };

    const calculateFormula = (event) => {
      const value = +event.target.value;
      // Тут меняем коофициенты для каждого элемента из списка. Элемент списка привязан к классу иконки
      const formulaMap = {
        "icon-1": 0.1,
        "icon-2": 0.01,
        "icon-3": 0.001,
        "icon-4": 0.0001,
        "icon-5": 0.00001,
        "icon-6": 0.000001,
        "icon-7": 0.000001,
        "icon-8": 0.0000001,
        "icon-9": 0.00000001,
        "icon-10": 0.000000001,
        "icon-11": 0.0000000001,
        "icon-12": 0.00000000001,
        "icon-13": 0.000000000001,
        "icon-14": 0.0000000000001,
        "icon-15": 0.00000000000001,
      };

      const formula = formulaMap[tokenIcon.classList[1]] || 0;
      resultInput.value = value > 0 ? formula * value : "";
    };

    if (dropdownButton) {
      dropdownButton.addEventListener("click", toggleDropdown);
    }

    if (dropdownList) {
      dropdownList.addEventListener("click", handleDropdownClick);
    }

    function toggleMenu() {
      burger.classList.toggle("active");
      const isActive = burger.classList.contains("active");
      nav.classList.toggle("active", isActive);
      body.classList.toggle("no-scroll", isActive);
    }

    function closeMenuOnResize() {
      if (window.innerWidth >= 808) {
        closeMenu();
      }
    }

    function closeMenu() {
      burger.classList.remove("active");
      nav.classList.remove("active");
      body.classList.remove("no-scroll");
    }

    function togglePopup(event) {
      if (
        event.target.classList.contains("btn--popup") ||
        event.target.classList.contains("popup__close") ||
        event.target.classList.contains("popup")
      ) {
        popup.classList.toggle("popup--open");
        popup.classList.toggle("popup--close");
      }
    }

    function toggleDropdown() {
      dropdownList.classList.toggle("open");
      tokenIcon.classList.toggle("open-list");
      if (tokenIcon.classList.contains("open-list")) {
        tokenIcon.className = "token__icon open-list";
        tokenName.textContent = "Выбрать токен"; // Тут заменяем дефолтную надпись
        valueInput.setAttribute("disabled", "disabled");
        Calculate();
      }
    }

    function handleDropdownClick(event) {
      if (event.target.tagName === "LI") {
        const selectedIconClass = event.target.childNodes[0].classList[1];
        tokenName.textContent = event.target.textContent;
        tokenIcon.className = "token__icon";
        tokenIcon.classList.add(selectedIconClass);
        dropdownList.classList.remove("open");
        valueInput.removeAttribute("disabled");
        valueInput.focus();
        Calculate();
      }
    }
  });
})();
